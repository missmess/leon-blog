{"componentChunkName":"component---themes-advanced-src-templates-post-query-ts","path":"/react-batch","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var n = Object.getOwnPropertySymbols(e); for (r = 0; r < n.length; r++) o = n[r], t.indexOf(o) >= 0 || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.indexOf(n) >= 0) continue; t[n] = r[n]; } return t; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"谈一谈React18的批处理\",\n  \"cover\": \"../static/assets/react18-feature.jpg\",\n  \"coverAlt\": \"封面\",\n  \"description\": \"介绍React18的并发和批处理相关知识\",\n  \"datePublished\": \"2024-06-24 19:28:20\",\n  \"dateModified\": \"2024-06-24 19:28:20\",\n  \"slug\": \"react-batch\",\n  \"category\": \"经验总结\",\n  \"tags\": [\"前端\", \"React\", \"架构\", \"造轮子\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"\\u6700\\u8FD1\\u7B14\\u8005\\u817E\\u51FA\\u4E86\\u5927\\u628A\\u7684\\u65F6\\u95F4\\uFF0C\\u5B66\\u4E60\\u4E86\\u4E00\\u4E0BReact18\\u3002\"), mdx(\"h3\", null, \"\\u5BFC\\u822A\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#%E4%BB%80%E4%B9%88%E6%98%AF%E6%89%B9%E5%A4%84%E7%90%86%EF%BC%9F\"\n  }, \"\\u4EC0\\u4E48\\u662F\\u6279\\u5904\\u7406\\uFF1F\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#react-18-%E4%B9%8B%E5%89%8D%E7%9A%84%E6%89%B9%E5%A4%84%E7%90%86\"\n  }, \"React18\\u4E4B\\u524D\\u7684\\u6279\\u5904\\u7406\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#react-18-%E7%9A%84%E8%87%AA%E5%8A%A8%E6%89%B9%E5%A4%84%E7%90%86\"\n  }, \"React18\\u7684\\u81EA\\u52A8\\u6279\\u5904\\u7406\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#%E6%89%B9%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86\"\n  }, \"\\u6279\\u5904\\u7406\\u539F\\u7406\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#%E9%80%80%E5%87%BA%E6%89%B9%E5%A4%84%E7%90%86\"\n  }, \"\\u9000\\u51FA\\u6279\\u5904\\u7406\"))), mdx(\"p\", null, \"\\u56DE\\u9996React\\u8FC7\\u5F80\\u7684\\u4E00\\u4E9B\\u91CD\\u5927\\u7248\\u672C\\uFF1A\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"React 16.0\\uFF082017\\u5E749\\u6708\\uFF09\\uFF1A\\u5E26\\u6765\\u4E86\\u5168\\u65B0\\u7684Fiber\\u67B6\\u6784\\uFF0C\\u5F15\\u5165\\u4E86\\u5F02\\u6B65\\u6E32\\u67D3\\u63D0\\u5347\\u6027\\u80FD\\uFF0C\\u5960\\u5B9A\\u4E86\\u5E76\\u53D1\\u6A21\\u5F0F\\u7684\\u57FA\\u7840\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"React 16.8\\uFF082019\\u5E742\\u6708\\uFF09\\uFF1A\\u5F15\\u5165\\u4E86\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"Hooks\"), \"\\uFF0C\\u5141\\u8BB8\\u51FD\\u6570\\u7EC4\\u4EF6\\u4E2D\\u7BA1\\u7406\\u72B6\\u6001\\u548C\\u526F\\u4F5C\\u7528\\u3002\\u4ECE\\u6B64\\u51FD\\u6570\\u7EC4\\u4EF6\\u4E00\\u53D1\\u4E0D\\u53EF\\u6536\\u62FE\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"React 17.0\\uFF082020\\u5E7410\\u6708\\uFF09\\uFF1A\\u6CA1\\u6709API\\u66F4\\u65B0\\uFF0C\\u4E3B\\u8981\\u662F\\u4E3A\\u4E86\\u672A\\u6765\\u5E73\\u6ED1\\u8FC7\\u6E2118.0\\u4EE5\\u53CA\\u63D0\\u5347\\u7A33\\u5B9A\\u6027\\u3002\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"React 18.0\\uFF082022\\u5E743\\u6708\\uFF09\\uFF1AReact18\\u5E26\\u6765\\u4E86\\u8BB8\\u591A\", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/facebook/react/blob/main/CHANGELOG.md#breaking-changes\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }, \"\\u65B0\\u7279\\u6027\"), \"\\uFF0C\\u5305\\u62EC\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"Concurrent Mode\"), \"\\uFF08\\u5E76\\u53D1\\u6A21\\u5F0F\\uFF09\\u3001\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"Automatic batching\"), \"\\uFF08\\u81EA\\u52A8\\u6279\\u5904\\u7406\\uFF09\\u3001\\u65B0\\u7684SSR API\\u3001\\u65B0\\u7684Suspense\\u3001\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"useTransition\"), \"\\u7B49\\u7B49...\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u8FD9\\u4E9B\\u65B0\\u7279\\u6027\\u662F\\u5728React18\\u6B63\\u5F0F\\u53D1\\u5E03\\u7684\\uFF0C\\u4F46\\u662F\\u770B\\u6E90\\u7801\\u7684\\u8BDD\\u5176\\u5B9E16.13\\u7684\\u7248\\u672C\\u91CC\\u5C31\\u5DF2\\u7ECF\\u6709\\u4E86\\u5E76\\u53D1\\u6A21\\u5F0F\\u76F8\\u5173\\u4EE3\\u7801\\u3002\\u53EA\\u4E0D\\u8FC7\\u90A3\\u4E2A\\u65F6\\u5019\\u4E0D\\u7A33\\u5B9A\\uFF0C\\u5904\\u4E8E\\u5F00\\u53D1\\u72B6\\u6001\\u3002\\u5E76\\u4E14\\u572817\\u7248\\u672C\\u65F6\\uFF0C\\u8FD8\\u63D0\\u4F9B\\u4E86\\u5F88\\u591A\\u5B9E\\u9A8C\\u6027\\u7684API\\u3002\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u5E76\\u53D1\\u6A21\\u5F0F\\u662F\\u4E00\\u79CD\\u5E95\\u5C42\\u8BBE\\u8BA1\\uFF0C\\u4E0D\\u5355\\u5355\\u6307\\u4E00\\u4E2A\\u529F\\u80FD\\uFF0C\\u800C\\u662F\\u4E00\\u7CFB\\u5217\\u5C0F\\u7279\\u6027\\u7684\\u96C6\\u5408\\u3002\\u5E76\\u53D1\\u6A21\\u5F0F\\u7684\\u5F00\\u542F\\u65B9\\u5F0F\\u5C31\\u662F\\u5C06\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ReactDOM.render\"), \"\\u6539\\u4E3A\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ReactDOM.createRoot\"), \"\\u3002\")), mdx(\"p\", null, \"18\\u65B0\\u7279\\u6027\\u5F88\\u591A\\uFF0C\\u6211\\u4EEC\\u4E00\\u4E2A\\u4E00\\u4E2A\\u53BB\\u8BB2\\u3002\\u672C\\u6B21\\u4E3B\\u8981\\u8BB2\\u89E3\\u5176\\u4E2D\\u7684\\u4E00\\u4E2A\\uFF1A\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Automatic batching\"), \"\\uFF0C\\u5373\\u81EA\\u52A8\\u6279\\u5904\\u7406\\u3002\\u5B98\\u65B9\\u89E3\\u91CA\\u8BF4\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u81EA\\u52A8\\u6279\\u5904\\u7406\"), \"\\u662F\\u4E00\\u6B21\\u6027\\u80FD\\u63D0\\u5347\\uFF0C\\u66F4\\u6539\\u4E86\\u6279\\u91CF\\u66F4\\u65B0\\u7684\\u65B9\\u5F0F\\u4EE5\\u81EA\\u52A8\\u6267\\u884C\\u66F4\\u591A\\u6279\\u5904\\u7406\\u3002\"), mdx(\"p\", null, \"\\u66F4\\u591A\\u6279\\u5904\\u7406\\uFF1F\\u90A3\\u5728React18\\u4E4B\\u524D\\u6709\\u6279\\u5904\\u7406\\u5417\\uFF1F\\u73B0\\u5728\\u53C8\\u505A\\u4E86\\u54EA\\u4E9B\\u6539\\u8FDB\\uFF1F\\u8BA9\\u6211\\u4EEC\\u5A13\\u5A13\\u9053\\u6765\\uFF1A\"), mdx(\"h3\", null, \"\\u4EC0\\u4E48\\u662F\\u6279\\u5904\\u7406\\uFF1F\"), mdx(\"p\", null, \"\\u6279\\u5904\\u7406\\u5C31\\u662F\\u5C06\\u4E00\\u7EC4\\u72B6\\u6001\\u66F4\\u65B0\\u5408\\u5E76\\uFF0C\\u53EA\\u89E6\\u53D1\\u4E00\\u6B21\\u6E32\\u67D3\\u7684\\u6027\\u80FD\\u4F18\\u5316\\u624B\\u6BB5\\u3002\\u6BD4\\u5982\\u5728\\u4E00\\u4E2A\\u70B9\\u51FB\\u4E8B\\u4EF6\\u91CC\\u6267\\u884C\\u591A\\u6761\\u72B6\\u6001\\u66F4\\u65B0\\uFF1A\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"jsx\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-jsx\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"App\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'App rendered'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), \"count\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" setCount\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useState\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"0\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), \"flag\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" setFlag\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useState\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token boolean\"\n  }, \"false\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"handleClick\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setCount\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"c\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" c \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"+\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Does not re-render yet\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setFlag\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"f\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!\"), \"f\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Does not re-render yet\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// React will only re-render once at the end (that's batching!)\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"<\"), \"div\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"\\n      \"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"<\"), \"button\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token attr-name\"\n  }, \"onClick\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token script language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token script-punctuation punctuation\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"handleClick\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"Next\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"</\"), \"button\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"\\n      \"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"<\"), \"h1\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token attr-name\"\n  }, \"style\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token script language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token script-punctuation punctuation\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token literal-property property\"\n  }, \"color\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" flag \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"?\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\\"blue\\\"\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\\"black\\\"\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"count\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"</\"), \"h1\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"\\n    \"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"</\"), \"div\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"p\", null, \"\\u793A\\u4F8B\\u4E2D\\u6709\\u4E24\\u4E2A\\u72B6\\u6001\\u66F4\\u65B0\\u5728\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"handleClick\"), \"\\u56DE\\u8C03\\u91CC\\u540C\\u6B65\\u6267\\u884C\\uFF0C\\u5982\\u679C\\u5B83\\u4EEC\\u53EA\\u89E6\\u53D1\\u4E00\\u6B21\\u6E32\\u67D3\\uFF0C\\u5373\\u4E3A\\u6279\\u5904\\u7406\\u3002\\uFF08\\u793A\\u4F8B\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://codesandbox.io/p/sandbox/spring-water-929i6\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }, \"CodeSandbox\"), \"\\uFF09\\u3002\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u5305\\u62EC\\u4E0B\\u9762\\u7684\\u793A\\u4F8B\\uFF0C\\u53C2\\u8003\\u7684\\u662F\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/reactwg/react-18/discussions/21\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }, \"\\u5B98\\u65B9discussion\"), \"\\u3002\")), mdx(\"h3\", null, \"React18\\u4E4B\\u524D\\u7684\\u6279\\u5904\\u7406\"), mdx(\"p\", null, \"\\u4E0A\\u9762\\u7684\\u793A\\u4F8B\\u5982\\u679C\\u5728React17\\u4E0A\\u6267\\u884C\\u7684\\u8BDD\\uFF0C\\u662F\\u53EA\\u89E6\\u53D1\\u4E00\\u6B21\\u6E32\\u67D3\\u7684\\u3002\\u8BF4\\u660E\\u572817\\u7248\\u672C\\u5DF2\\u7ECF\\u5B58\\u5728\\u4E86\\u6279\\u5904\\u7406\\u7684\\u80FD\\u529B\\u3002\\u4F46\\u662F17\\u7248\\u672C\\u53EA\\u5BF9\\u4E8B\\u4EF6\\u5904\\u7406\\u5668\\u4E2D\\u7684\\u72B6\\u6001\\u66F4\\u65B0\\u8FDB\\u884C\\u4E86\\u6279\\u5904\\u7406\\u3002\\u800C\\u5BF9\\u4E8E\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"setTimeout\"), \"\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Promise\"), \"\\u3001\\u6216\\u8005\\u662F\\u539F\\u751Fdom\\u4E8B\\u4EF6\\u91CC\\u7684\\u72B6\\u6001\\u66F4\\u65B0\\u5219\\u4E0D\\u4F1A\\u4F7F\\u7528\\u6279\\u5904\\u7406\\u3002\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"javascript\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"handleClick\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"fetchSomething\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"then\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// React 17 and earlier does NOT batch these because\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// they run *after* the event in a callback, not *during* it\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setCount\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"c\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" c \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"+\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Causes a re-render\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setFlag\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"f\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!\"), \"f\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Causes a re-render\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"p\", null, \"\\u793A\\u4F8B\\u4E2D\\uFF0C\\u591A\\u52A0\\u4E86\\u4E00\\u4E2Afetch\\u63A5\\u53E3\\u5E76\\u5728Promise\\u5904\\u7406\\u540E\\u89E6\\u53D1\\u4E24\\u4E2A\\u72B6\\u6001\\u66F4\\u65B0\\u3002\\u572817\\u7248\\u672C\\u4E0A\\u4F1A\\u53D1\\u73B0\\uFF0C\\u5B83\\u89E6\\u53D1\\u4E86\\u4E24\\u6B21\\u6E32\\u67D3\\u3002\\uFF08\\u793A\\u4F8B\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://codesandbox.io/p/sandbox/trusting-khayyam-cn5ct\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }, \"CodeSandbox\"), \"\\uFF09\\u3002\"), mdx(\"h3\", null, \"React18\\u7684\\u81EA\\u52A8\\u6279\\u5904\\u7406\"), mdx(\"p\", null, \"\\u4E0A\\u9762\\u793A\\u4F8B\\u4E2D\\u8FD0\\u884C\\u5728React18\\u7684\\u5E76\\u53D1\\u6A21\\u5F0F\\u4E0B\\u3002\\u4E0D\\u7BA1\\u662F\\u672A\\u52A0fetch\\u8FD8\\u662F\\u52A0\\u4E86fetch\\u7684\\u591A\\u6B21\\u72B6\\u6001\\u66F4\\u65B0\\uFF08\\u793A\\u4F8B\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://codesandbox.io/p/sandbox/morning-sun-lgz88\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }, \"CodeSandbox\"), \"\\uFF09\\uFF0C\\u8FD0\\u884C\\u540E\\u90FD\\u53EA\\u89E6\\u53D1\\u4E86\\u4E00\\u6B21\\u6E32\\u67D3\\uFF0C\\u6240\\u4EE5\\u5B83\\u4EEC\\u7684\\u66F4\\u65B0\\u90FD\\u8FDB\\u884C\\u4E86\\u6279\\u5904\\u7406\\u3002\\u8FD9\\u5C31\\u662F18\\u7248\\u672C\\u7684\\u81EA\\u52A8\\u6279\\u5904\\u7406\\u3002\"), mdx(\"p\", null, \"\\u4F46\\u662F\\u8981\\u6CE8\\u610F\\u7684\\u662F\\uFF0C\\u5982\\u679C18\\u7248\\u672C\\u672A\\u5F00\\u542F\\u5E76\\u53D1\\u6A21\\u5F0F\\u3002\\u5373\\u4ECD\\u7136\\u4F7F\\u7528\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ReactDOM.render\"), \"\\u4F5C\\u4E3A\\u6E32\\u67D3\\u5165\\u53E3\\uFF0C\\u5219\\u4F7F\\u7528\\u7684\\u662F\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Legacy\"), \"\\u6A21\\u5F0F\\u3002\\u5B83\\u7684\\u8868\\u73B0\\u4F1A\\u548C17\\u7248\\u672C\\u7684\\u4E00\\u81F4\\u3002\\uFF08\\u793A\\u4F8B\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://codesandbox.io/p/sandbox/jolly-benz-hb1zx\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }, \"CodeSandbox\"), \"\\uFF09\\u3002\"), mdx(\"h3\", null, \"\\u6279\\u5904\\u7406\\u539F\\u7406\"), mdx(\"p\", null, \"\\u63A5\\u4E0B\\u6765\\u6211\\u4EEC\\u76F4\\u63A5\\u67E5\\u770BReact18\\u6E90\\u7801\\uFF0C\\u5E76\\u5C06Legacy\\u6A21\\u5F0F\\u5BF9\\u5E94\\u4E3AReact17\\u7684\\u8868\\u73B0\\u3002\\u5206\\u6790\\u4E0B\\u4E09\\u4E2A\\u95EE\\u9898\\uFF1A\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u4E3A\\u4EC0\\u4E48Legacy\\u6A21\\u5F0F\\u4E0B\\uFF0C\\u4E8B\\u4EF6\\u5904\\u7406\\u5668\\u4E0B\\u7684\\u66F4\\u65B0\\u53EF\\u4EE5\\u6279\\u5904\\u7406\\u3002\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u4E3A\\u4EC0\\u4E48Legacy\\u6A21\\u5F0F\\u4E0B\\uFF0CPromise\\u6216setTimeout\\u6216\\u539F\\u751Fdom\\u4E8B\\u4EF6\\u4E0B\\u7684\\u66F4\\u65B0\\u4E0D\\u53EF\\u4EE5\\u6279\\u5904\\u7406\\u3002\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u4E3A\\u4EC0\\u4E48\\u5E76\\u53D1\\u6A21\\u5F0F\\u4E0B\\uFF0C\\u4E8B\\u4EF6\\u5904\\u7406\\u5668\\u3001Promise\\u3001setTimeout\\u3001\\u539F\\u751Fdom\\u4E8B\\u4EF6\\u4E0B\\u7684\\u66F4\\u65B0\\u90FD\\u53EF\\u4EE5\\u6279\\u5904\\u7406\\u3002\"))), mdx(\"p\", null, \"\\u6211\\u4EEC\\u4ECE\\u89E6\\u53D1\\u66F4\\u65B0\\u7684\\u5165\\u53E3\\u5F00\\u59CB\\u67E5\\u770B\\u3002\\u5982\\u679C\\u662F\\u7C7B\\u7EC4\\u4EF6\\u7684\\u8BDD\\uFF0C\\u4F1A\\u8C03\\u7528\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"this.setState\"), \"\\uFF1B\\u5982\\u679C\\u662F\\u51FD\\u6570\\u7EC4\\u4EF6\\uFF0C\\u4F1A\\u8C03\\u7528\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"useState\"), \"\\u8FD4\\u56DE\\u7684\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"dispatch\"), \"\\u51FD\\u6570\\u3002\\u8FD9\\u91CC\\u770B\\u54EA\\u4E2A\\u90FD\\u53EF\\u4EE5\\uFF0C\\u9664\\u4E86\\u7B2C\\u4E00\\u6B65\\u4E0D\\u4E00\\u6837\\uFF0C\\u540E\\u7EED\\u6D41\\u7A0B\\u90FD\\u4E00\\u6837\\u3002\\u6211\\u4EEC\\u76F4\\u63A5\\u5206\\u6790\\u7C7B\\u7EC4\\u4EF6\\u7684\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"this.setState\"), \"\\u5165\\u53E3\\uFF1A\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"setState\"), \"\\u65B9\\u6CD5\\u4F1A\\u6267\\u884C\\u5230\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"classComponentUpdater\"), \"\\u7684\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"enqueueSetState\"), \"\\u65B9\\u6CD5\\u3002\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"enqueueSetState\"), \"\\u65B9\\u6CD5\\u4F1A\\u521B\\u5EFA\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"Update\"), \"\\uFF0C\\u8BF7\\u6C42lane\\uFF0C\\u7136\\u540E\\u8C03\\u7528\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"scheduleUpdateOnFiber\"), \"\\u51C6\\u5907\\u8C03\\u5EA6\\u66F4\\u65B0\\u3002\")), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"javascript\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u7B80\\u5316\\uFF0C\\u53BB\\u6389\\u4E0D\\u91CD\\u8981\\u7684\\u90E8\\u5206\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"enqueueSetState\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"inst\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" payload\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" callback\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"var\"), \" lane \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"requestUpdateLane\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"var\"), \" update \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createUpdate\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"lane\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"root \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!==\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"null\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"scheduleUpdateOnFiber\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"root\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" fiber\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" lane\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"ol\", {\n    \"start\": 2\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"requestUpdateLane\"), \"\\u65B9\\u6CD5\\u7528\\u4E8E\\u83B7\\u53D6\\u5F53\\u524D\\u66F4\\u65B0\\u7684lane\\u3002\\u91CD\\u70B9\\u662FLegacy\\u6A21\\u5F0F\\u4E0B\\u4E00\\u5B9A\\u662F\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"SyncLane\"), \"\\u3002\\u5E76\\u53D1\\u6A21\\u5F0F\\u4E0B\\u4F1A\\u8BFB\\u53D6\\u63D0\\u524D\\u9884\\u8BBE\\u7684\\u503C\\u6216\", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/facebook/react/blob/a15bbe14751287cb7ac124ff88f694d0883f3ac6/packages/react-dom-bindings/src/events/ReactDOMEventListener.js#L290\",\n    \"target\": \"_blank\",\n    \"rel\": \"nofollow noopener noreferrer\"\n  }, \"\\u6839\\u636Ewindow.event\\u83B7\\u53D6\"), \"\\u3002\")), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"javascript\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"requestUpdateLane\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"fiber\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u975E\\u5E76\\u53D1\\u6A21\\u5F0F\\uFF0C\\u4E00\\u5B9A\\u662FSyncLane\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"mode \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"&\"), \" ConcurrentMode\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"===\"), \" NoMode\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" SyncLane\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u5148\\u4ECE\\u9884\\u8BBE\\u7684\\u5B57\\u6BB5\\u8BFB\\u53D6lane\\u3002\\u7531react\\u5728\\u90E8\\u5206\\u60C5\\u51B5\\uFF08\\u6BD4\\u5982click\\u4E8B\\u4EF6\\u524D\\uFF09\\u4E0B\\u63D0\\u524D\\u8BBE\\u7F6E\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"var\"), \" updateLane \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"getCurrentUpdatePriority\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"updateLane \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!==\"), \" NoLane\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" updateLane\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u5426\\u5219\\u6839\\u636Ewindow.event\\u5224\\u65AD\\u5F53\\u524Dlane\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"var\"), \" eventLane \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"getCurrentEventPriority\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" eventLane\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"ol\", {\n    \"start\": 3\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"scheduleUpdateOnFiber\"), \"\\u65B9\\u6CD5\\u4F1A\\u8C03\\u7528\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"ensureRootIsScheduled\"), \"\\u65B9\\u6CD5\\u53D1\\u8D77\\u8C03\\u5EA6\\u66F4\\u65B0\\uFF0C\\u8FDB\\u5230\\u7B2C4\\u6B65\\u3002\\u5E76\\u5728\\u7ED3\\u675F\\u540E\\uFF0C\\u5224\\u65AD\\u662F\\u5426\\u8981\\u5237\\u65B0\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"Scheduler\"), \"\\u7684\\u540C\\u6B65callback\\uFF0C\\u8FDB\\u5230\\u7B2C5\\u6B65\\u3002\")), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"javascript\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u7B80\\u5316\\uFF0C\\u53BB\\u6389\\u4E0D\\u91CD\\u8981\\u7684\\u90E8\\u5206\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"scheduleUpdateOnFiber\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"root\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" fiber\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" lane\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"ensureRootIsScheduled\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"root\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u540C\\u6B65\\u4F18\\u5148\\u7EA7 && \\u6CA1\\u6709\\u6267\\u884C\\u4E0A\\u4E0B\\u6587 && \\u975E\\u5E76\\u53D1\\u6A21\\u5F0F\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"lane \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"===\"), \" SyncLane \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"&&\"), \" executionContext \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"===\"), \" NoContext \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"&&\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"fiber\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"mode \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"&\"), \" ConcurrentMode\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"===\"), \" NoMode\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Scheduler\\u6267\\u884C\\u9AD8\\u4F18\\u4EFB\\u52A1\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"flushSyncCallbacks\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"ol\", {\n    \"start\": 4\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"ensureRootIsScheduled\"), \"\\u65B9\\u6CD5\\u6839\\u636Elane\\u5224\\u65AD\\u662F\\u5426\\uFF1A\\u4E0D\\u9700\\u8981\\u53D1\\u8D77\\u4E00\\u6B21\\u65B0\\u8C03\\u5EA6\\uFF1B\\u9700\\u8981\\u53D6\\u6D88\\u5DF2\\u8C03\\u5EA6\\u66F4\\u65B0\\uFF0C\\u5E76\\u53D1\\u8D77\\u65B0\\u8C03\\u5EA6\\uFF1B\\u4E0D\\u9700\\u8981\\u53D6\\u6D88\\u5DF2\\u8C03\\u5EA6\\u66F4\\u65B0\\uFF0C\\u5E76\\u53D1\\u8D77\\u65B0\\u8C03\\u5EA6\\uFF1B\\u53D1\\u8D77\\u6307\\u5B9A\\u4F18\\u5148\\u7EA7\\u7684\\u8C03\\u5EA6\\u3002\\u8C03\\u5EA6\\u6210\\u529F\\u540E\\uFF0C\\u53D1\\u8D77\\u4E00\\u4E2A\\u5FAE\\u4EFB\\u52A1\\u5904\\u7406\\u6389Scheduler\\u9AD8\\u4F18\\u4EFB\\u52A1\\u3002\")), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"javascript\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"ensureRootIsScheduled\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"root\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" currentTime\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u83B7\\u53D6\\u672C\\u6B21\\u66F4\\u65B0\\u7684lanes\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"var\"), \" nextLanes \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"getNextLanes\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"root\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" workInProgressRootRenderLanes\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"var\"), \" newCallbackPriority \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"getHighestPriorityLane\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"nextLanes\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"var\"), \" existingCallbackPriority \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" root\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"callbackPriority\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u5DF2\\u8C03\\u5EA6\\u66F4\\u65B0\\u7684\\u4F18\\u5148\\u7EA7 === \\u672C\\u6B21\\u66F4\\u65B0\\u4F18\\u5148\\u7EA7\\uFF0C\\u4E0D\\u9700\\u8981\\u518D\\u53D1\\u8D77\\u4E00\\u6B21\\u8C03\\u5EA6\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"existingCallbackPriority \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"===\"), \" newCallbackPriority\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u6253\\u65AD\\u5DF2\\u8C03\\u5EA6\\u66F4\\u65B0\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"existingCallbackNode \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"null\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"cancelCallback$1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"existingCallbackNode\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u672C\\u6B21\\u662F\\u540C\\u6B65\\u4F18\\u5148\\u7EA7\\uFF0C\\u5219\\u5728Scheduler\\u90A3\\u91CC\\u8C03\\u5EA6\\u4E00\\u6B21\\u9AD8\\u4F18\\u6E32\\u67D3\\u4EFB\\u52A1\\u3002\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"newCallbackPriority \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"===\"), \" SyncLane\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"scheduleSyncCallback\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"performSyncWorkOnRoot\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"bind\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"null\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" root\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"else\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// lane\\u8F6C\\u4E3AScheduler\\u4F18\\u5148\\u7EA7\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"switch\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"lanesToEventPriority\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"nextLanes\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"/* ... */\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u5728Scheduler\\u90A3\\u91CC\\u8C03\\u5EA6\\u4E00\\u6B21\\u6307\\u5B9A\\u4F18\\u5148\\u7EA7\\u6E32\\u67D3\\u4EFB\\u52A1\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"scheduleCallback$1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"schedulerPriorityLevel\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"performConcurrentWorkOnRoot\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"bind\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"null\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" root\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\u4F5C\\u4E3A\\u5FAE\\u4EFB\\u52A1\\u4E2D\\uFF0C\\u5904\\u7406\\u6389Scheduler\\u4E2D\\u7684\\u9AD8\\u4F18\\u4EFB\\u52A1\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"scheduleMicrotask\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"flushSyncCallbacks\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"ol\", {\n    \"start\": 5\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u5982\\u679C\\u7B2C3\\u6B65\\u4E2D\\uFF0C\", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"lane\\u4E3A\\u540C\\u6B65\\u4F18\\u5148\\u7EA7\"), \"\\u4E14\", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"\\u6CA1\\u6709\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\"), \"\\u4E14\", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"\\u975E\\u5E76\\u53D1\\u6A21\\u5F0F\"), \"\\uFF0C\\u5C31\\u4F1A\\u8D70\\u5230\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"flushSyncCallbacks\"), \"\\u65B9\\u6CD5\\uFF0C\\u8BE5\\u65B9\\u6CD5\\u5C31\\u662F\\u5C06Scheduler\\u4E2D\\u9AD8\\u4F18\\u4EFB\\u52A1\\u6267\\u884C\\u6389\\u3002\\u8FD9\\u4E2A\\u4EFB\\u52A1\\u5C31\\u5305\\u62EC\\u6211\\u4EEC\\u53EF\\u80FD\\u5728\\u521A\\u521A\\u8C03\\u5EA6\\u7684\\u6E32\\u67D3\\u4EFB\\u52A1\\u3002\")), mdx(\"p\", null, \"\\u6E90\\u7801\\u770B\\u5B8C\\u4E86\\uFF0C\\u6211\\u4EEC\\u63A5\\u4E0B\\u6765\\u8C03\\u8BD5\\u4E0B\\u4EE3\\u7801\\uFF0C\\u518D\\u7ED3\\u5408\\u4EE3\\u7801\\uFF0C\\u627E\\u4E00\\u4E0B3\\u4E2A\\u95EE\\u9898\\u7684\\u7B54\\u6848\\uFF1A\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Legacy\\u6A21\\u5F0F\\u4E0B\\uFF0C\\u66F4\\u65B0\\u7684lane\\u503C\\u59CB\\u7EC8\\u662F\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"SyncLane\"), \"\\u3002\\u5E76\\u53D1\\u6A21\\u5F0F\\u4E0B\\uFF0C\\u6839\\u636E\\u66F4\\u65B0\\u7C7B\\u578B\\u83B7\\u53D6lane\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ensureRootIsScheduled\"), \"\\u65B9\\u6CD5\\u4E2D\\uFF0C\\u5982\\u679C\\u524D\\u9762\\u8C03\\u5EA6\\u4E86\\u4E00\\u6B21\\u66F4\\u65B0\\uFF0C\\u540E\\u9762\\u89E6\\u53D1\\u7684\\u66F4\\u65B0\\u4F18\\u5148\\u7EA7\\u4E00\\u6837\\uFF0C\\u90A3\\u5C31\\u76F4\\u63A5return\\u6389\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u5982\\u679C\\u66F4\\u65B0\\u6CA1\\u6709\\u88ABreturn\\u6389\\u7684\\u8BDD\\uFF0CLegacy\\u6A21\\u5F0F\\u4E0B\\uFF0C\\u5C31\\u4F1A\\u53BBScheduler\\u90A3\\u91CC\\u8C03\\u5EA6\\u4E00\\u6B21\\u9AD8\\u4F18\\u6E32\\u67D3\\u4EFB\\u52A1\\u3002\\u5E76\\u53D1\\u6A21\\u5F0F\\u4E0B\\uFF0C\\u5C31\\u4F1A\\u53BB\\u8C03\\u5EA6\\u4E00\\u6B21\\u6307\\u5B9A\\u4F18\\u5148\\u7EA7\\u7684\\u6E32\\u67D3\\u4EFB\\u52A1\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"scheduleUpdateOnFiber\"), \"\\u65B9\\u6CD5\\u91CC\\uFF0C\\u5982\\u679C\\u5F53\\u524D\\u6CA1\\u6709\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\"), \"\\uFF0C\\u5219\\u9AD8\\u4F18\\u4EFB\\u52A1\\u4F1A\\u7ACB\\u523B\\u6267\\u884C\\u3002\\u5982\\u679C\\u6709\\u4E0A\\u4E0B\\u6587\\uFF0C\\u5219\\u9AD8\\u4F18\\u4EFB\\u52A1\\u4F1A\\u4F5C\\u4E3A\\u5FAE\\u4EFB\\u52A1\\u5728\\u540C\\u6B65\\u4EE3\\u7801\\u7ED3\\u675F\\u540E\\u5F02\\u6B65\\u6267\\u884C\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u4E8B\\u4EF6\\u5904\\u7406\\u5668\\u91CC\\u9762\\u89E6\\u53D1\\u7684\\u66F4\\u65B0\\uFF0C\\u5728\\u6267\\u884C\\u65F6\\u662F\\u6709\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\"), \"\\u7684\\u3002\\u4F46\\u662FPromise\\u91CC\\u9762\\u89E6\\u53D1\\u7684\\u66F4\\u65B0\\u6CA1\\u6709\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\u3002\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"\\uFF08\\u8FD9\\u662F\\u56E0\\u4E3A\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\u662F\\u5728\\u4E8B\\u4EF6\\u5904\\u7406\\u5668callback\\u56DE\\u8C03\\u524D\\u8BBE\\u7F6E\\uFF0C\\u5728\\u7ED3\\u675F\\u540E\\u7F6E\\u7A7A\\u3002\\u6240\\u4EE5\\u5F02\\u6B65\\u7684Promise\\u91CC\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\u5C31\\u662F\\u7A7A\\u7684\\uFF09\\u3002\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u8FD9\\u5C31\\u89E3\\u91CA\\u4E86\\u95EE\\u98981\\u7684\\u8868\\u73B0\\uFF0C\\u7531\\u4E8E\\u6709\\u4E0A\\u4E0B\\u6587\\uFF0C\\u5E76\\u4E14\\u90FD\\u662F\\u540C\\u6B65\\u4F18\\u5148\\u7EA7\\u3002\\u6240\\u4EE5\\u540E\\u9762\\u7684setState\\u7684\\u66F4\\u65B0\\u88ABreturn\\u6389\\u4E86\\uFF0C\\u6E32\\u67D3\\u4EFB\\u52A1\\u4F1A\\u5728\\u5FAE\\u4EFB\\u52A1\\u91CC\\u6267\\u884C\\u3002\\u5B9E\\u73B0\\u4E86\\u6279\\u5904\\u7406\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u95EE\\u98982\\uFF0C\\u7531\\u4E8E\\u6CA1\\u6709\\u4E0A\\u4E0B\\u6587\\uFF0C\\u4F46\\u662F\\u662F\\u540C\\u6B65\\u4F18\\u5148\\u7EA7\\uFF0C\\u6240\\u4EE5\\u8C03\\u7528\\u4E00\\u6B21\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"setState\"), \"\\uFF0C\\u4FBF\\u7ACB\\u5373\\u5B8C\\u6210\\u4E00\\u6B21\\u6E32\\u67D3\\u3002\\u518D\\u6B21\\u8C03\\u7528\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"setState\"), \"\\u65F6\\uFF0C\\u53C8\\u7ACB\\u5373\\u5B8C\\u6210\\u4E00\\u6B21\\u6E32\\u67D3\\u3002\\u6CA1\\u6709\\u5B9E\\u73B0\\u6279\\u5904\\u7406\\u3002\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u95EE\\u98983\\uFF0C\\u5E76\\u53D1\\u6A21\\u5F0F\\u4E0B\\u4E0D\\u4F1A\\u7ACB\\u5373\\u6267\\u884C\\u6E32\\u67D3\\u4EFB\\u52A1\\uFF0C\\u6700\\u5FEB\\u4E5F\\u8981\\u7B49\\u5230\\u5FAE\\u4EFB\\u52A1\\u3002\\u6240\\u4EE5\\u4E0D\\u7BA1\\u5728\\u54EA\\u91CC\\u7684\\u591A\\u6B21\\u66F4\\u65B0\\uFF0C\\u56E0\\u4E3A\\u6709\\u76F8\\u540C\\u4F18\\u5148\\u7EA7\\uFF0C\\u6700\\u540E\\u8D70\\u5230return\\u3002\\u4E5F\\u5C31\\u662F\\u81EA\\u52A8\\u6279\\u5904\\u7406\\u7279\\u6027\\u3002\"))), mdx(\"p\", null, \"\\u5230\\u8FD9\\u91CC\\uFF0C\\u6211\\u4EEC\\u5C31\\u975E\\u5E38\\u6E05\\u695A\\u7684\\u4E86\\u89E3\\u4E86\\u6279\\u5904\\u7406\\u7684\\u5B9E\\u73B0\\u539F\\u7406\\uFF0C\\u4EE5\\u53CA18\\u7248\\u672C\\u524D\\u540E\\u7684\\u5DEE\\u5F02\\u539F\\u56E0\\u3002\"), mdx(\"p\", null, \"\\u518D\\u6765\\u4E00\\u4E2A\\u590D\\u6742\\u7684\\u4F8B\\u5B50\\uFF0C\\u5C1D\\u8BD5\\u5206\\u6790\\u4E0B\\u8FD9\\u4E2A\\u60C5\\u51B5\\uFF1A\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"jsx\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-jsx\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"App\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), \"count\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" setCount\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useState\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"0\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"App render\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"plus\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setCount\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"count \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"+\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    Promise\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"resolve\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"then\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setCount\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"count \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"+\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"2\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"<\"), \"div\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"\\n    \"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"<\"), \"p\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"count\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"</\"), \"p\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"\\n    \"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"/* \\u70B9\\u51FB\\u4F1Arender\\u4E24\\u6B21\\uFF0C\\u6ED1\\u5165\\u5374\\u53EArender\\u4E00\\u6B21 */\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"\\n    \"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"<\"), \"span\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token attr-name\"\n  }, \"onClick\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token script language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token script-punctuation punctuation\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"plus\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token attr-name\"\n  }, \"onMouseEnter\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token script language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token script-punctuation punctuation\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"plus\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"\\n      \\u6ED1\\u5165\\u6216\\u70B9\\u51FB\\n    \"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"</\"), \"span\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token plain-text\"\n  }, \"\\n    \"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token tag\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"</\"), \"div\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \">\")), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"p\", null, \"\\u793A\\u4F8B\\u4E2D\\uFF0C\\u5728\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onClick\"), \"\\u548C\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onMouseEnter\"), \"\\u56DE\\u8C03\\u4E2D\\u90FD\\u6267\\u884C\\u4E86\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"plus()\"), \"\\u65B9\\u6CD5\\uFF0C\\u4F46\\u662F\\u7ED3\\u679C\\u5374\\u5B8C\\u5168\\u4E0D\\u4E00\\u6837\\u3002\\u6709\\u7AE5\\u978B\\u77E5\\u9053\\u662F\\u4E3A\\u4EC0\\u4E48\\u5417\\uFF1F\"), mdx(\"p\", null, \"\\u76F4\\u63A5\\u516C\\u5E03\\u7B54\\u6848\\uFF1A\"), mdx(\"p\", null, mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onMouseEnter\"), \"\\u56DE\\u8C03\\u4E2D\\u89E6\\u53D1\\u7684\\u66F4\\u65B0\\u4E3A\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"InputContinuousLane\"), \"\\uFF0C\\u800C\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onClick\"), \"\\u56DE\\u8C03\\u4E2D\\u89E6\\u53D1\\u7684\\u66F4\\u65B0\\u4E3A\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"SyncLane\"), \"\\u3002\\u7B2C\\u4E00\\u6B21setCount\\u548C\\u7B2C\\u4E8C\\u6B21setCount\\u7684lane\\u76F8\\u540C\\uFF08\\u53EA\\u662F\\u4E00\\u4E2A\\u662F\\u4ECE\\u9884\\u8BBE\\u503C\\u83B7\\u53D6\\uFF0C\\u4E00\\u4E2A\\u662F\\u901A\\u8FC7window.event\\u83B7\\u53D6\\uFF09\\u3002\"), mdx(\"p\", null, \"\\u7531\\u4E8EmouseEnter\\u4E8B\\u4EF6\\u662F\\u666E\\u901A\\u4F18\\u5148\\u7EA7\\uFF0C\\u6240\\u4EE5\\u8C03\\u7528\\u7B2C\\u4E00\\u6B21setCount\\u540E\\uFF0C\\u4F1A\\u8C03\\u5EA6\\u4E00\\u6B21\\u6E32\\u67D3\\u4EFB\\u52A1\\uFF0C\\u540E\\u7EED\\u5B8F\\u4EFB\\u52A1\\u4E2D\\u6267\\u884C\\u3002\\u5FAE\\u4EFB\\u52A1\\u4E2D\\u7684\\u7B2C\\u4E8C\\u6B21setCount\\uFF0C\\u4F18\\u5148\\u7EA7\\u76F8\\u540C\\uFF0C\\u6240\\u4EE5return\\u6389\\u4E86\\u3002\\u6700\\u7EC8\\u4EC5\\u6E32\\u67D3\\u4E00\\u6B21\\u3002\"), mdx(\"p\", null, \"\\u7531\\u4E8Eclick\\u4E8B\\u4EF6\\u662F\\u540C\\u6B65\\u4F18\\u5148\\u7EA7\\uFF0C\\u6240\\u4EE5\\u7B2C\\u4E00\\u6B21setCount\\u540E\\u4F1A\\u5728\\u5FAE\\u4EFB\\u52A1\\u5B8C\\u6210\\u4E00\\u6B21\\u6E32\\u67D3\\u4EFB\\u52A1\\u3002\\u7B2C\\u4E8C\\u6B21setCount\\u4E5F\\u662F\\u5728\\u5FAE\\u4EFB\\u52A1\\u4E2D\\uFF0C\\u5B83\\u6392\\u5728\\u6E32\\u67D3\\u4EFB\\u52A1\\u540E\\u9762\\u3002\\u6240\\u4EE5\\u4F1A\\u5148\\u5B8C\\u6210\\u6E32\\u67D3\\uFF0C\\u518D\\u6267\\u884C\\u7B2C\\u4E8C\\u6B21setCount\\uFF0C\\u5E76\\u518D\\u6B21\\u5B8C\\u6210\\u4E00\\u6B21\\u6E32\\u67D3\\u3002\\u6700\\u7EC8\\u6E32\\u67D3\\u4E24\\u6B21\\u3002\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u601D\\u8003\\u9898\\uFF1A\\u5982\\u679C\\u5C06\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"plus()\"), \"\\u4E2D\\u7684Promise\\u6362\\u6210setTimeout\\u3002\\u4E24\\u4E2A\\u4E8B\\u4EF6\\u5206\\u522B\\u4F1A\\u6E32\\u67D3\\u51E0\\u6B21\\uFF1F\\uFF08\\u90FD\\u6E32\\u67D3\\u4E24\\u6B21\\uFF09\\u3002\")), mdx(\"h3\", null, \"\\u9000\\u51FA\\u6279\\u5904\\u7406\"), mdx(\"p\", null, \"\\u6211\\u4EEC\\u4E0A\\u9762\\u5206\\u6790\\u5230\\u95EE\\u98982\\u7684\\u60C5\\u51B5\\uFF0C\\u4F1A\\u5728\\u8C03\\u7528\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"setState\"), \"\\u540E\\u7ACB\\u5373\\u5B8C\\u6210\\u4E00\\u6B21\\u6E32\\u67D3\\u3002\\u662F\\u4E0D\\u662F\\u8BF4\\u660E\\u5728\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"setState\"), \"\\u540E\\u83B7\\u53D6\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"this.state\"), \"\\u80FD\\u53D6\\u5230\\u6700\\u65B0\\u7684\\u72B6\\u6001\\u5462\\uFF1F\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"javascript\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// React17\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"handleClick\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setTimeout\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"this\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setState\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" count \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"count\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" count \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"+\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n    console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"this\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"state\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// { count: 1, flag: false }\"), \"\\n\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"this\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setState\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" flag \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"flag\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!\"), \"flag \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")))), mdx(\"p\", null, \"\\u7B54\\u6848\\u662F\\u80AF\\u5B9A\\u7684\\uFF0C\\u7531\\u4E8E\\u662F\\u540C\\u6B65\\u6267\\u884C\\u7684\\u6E32\\u67D3\\uFF0C\\u6240\\u4EE5this.state\\u4E5F\\u5728\\u66F4\\u65B0\\u5B8C\\u6210\\u540E\\u53D8\\u66F4\\u4E86\\u3002\\u6240\\u4EE5\\u53D6\\u5230\\u7684\\u5C31\\u662F\\u6700\\u65B0\\u7684state\\u3002\\u8FD9\\u662F\\u7C7B\\u7EC4\\u4EF6\\u7684\\u8868\\u73B0\\uFF0C\\u90A3\\u51FD\\u6570\\u7EC4\\u4EF6\\u4E0B\\u53D6\\u5230\\u7684state\\u4F1A\\u662F\\u6700\\u65B0\\u7684\\u5417\\uFF1F\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"\\uFF08\\u5F53\\u7136\\u4E0D\\u53EF\\u80FD\\u554A\\uFF01\\u56E0\\u4E3A\\u51FD\\u6570\\u7EC4\\u4EF6\\u4E2D\\u7684\\u53D8\\u91CF\\u662F\\u5FEB\\u7167\\u554A\\uFF0C\\u4E5F\\u5373\\u4E34\\u65F6\\u53D8\\u91CF\\uFF0C\\u53EF\\u4E0D\\u7BA1\\u4F60\\u6E32\\u67D3\\u5B8C\\u6210\\u4E86\\u8FD8\\u662F\\u6CA1\\u5B8C\\u6210\\uFF09\\u3002\")), mdx(\"p\", null, \"React18\\u5E76\\u53D1\\u6A21\\u5F0F\\u4E0B\\u7531\\u4E8E\\u90FD\\u662F\\u6279\\u5904\\u7406\\uFF0C\\u6240\\u4EE5\\u540C\\u6837\\u7684\\u4EE3\\u7801\\uFF0C\\u5728\\u8FD9\\u91CC\\u7684console\\uFF0C\\u5C31\\u4F1A\\u6253\\u5370\\u51FA\\u4E0D\\u4E00\\u6837\\u7684\\u7ED3\\u679C\\u3002\\u5373\\u8FD8\\u662F\\u539F\\u6765\\u7684state\\uFF08\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"{ count: 0, flag: false }\"), \"\\uFF09\\u3002\\u8FD9\\u4E5F\\u662F\\u4E2A\\u95EE\\u9898\\u54C8\\uFF0C\\u5982\\u679C\\u6211\\u4ECEReact17\\u5347\\u7EA7\\u5230React18\\uFF0C\\u8FD9\\u91CC\\u5C31\\u51FA\\u73B0\\u4E86\\u8868\\u73B0\\u4E0D\\u4E00\\u81F4\\u4E86\\u3002\"), mdx(\"p\", null, \"\\u6240\\u4EE5React\\u63D0\\u4F9B\\u4E86\\u4E00\\u4E2A\\u65B0\\u7684api\\uFF1A\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ReactDOM.flushSync\"), \"\\uFF0C\\u8FD9\\u4E2A\\u65B9\\u6CD5\\u53EF\\u4EE5\\u8BA9\\u67D0\\u4E2A\\u72B6\\u6001\\u66F4\\u65B0\\u7ACB\\u5373\\u5B8C\\u6210\\u6E32\\u67D3\\u3002\\u6240\\u4EE5\\u4EE3\\u7801\\u53D8\\u4E3A\\uFF1A\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"javascript\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// React18\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"handleClick\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setTimeout\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    ReactDOM\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"flushSync\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"this\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setState\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" count \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"count\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" count \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"+\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n    console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"this\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"state\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// { count: 1, flag: false }\"), \"\\n\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"this\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"setState\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" flag \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"flag\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!\"), \"flag \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")))));\n}\n;\nMDXContent.isMDXComponent = true;","timeToRead":1,"excerpt":"最近笔者腾出了大把的时间，学习了一下React18。 导航 什么是批处理？ React18之前的批处理 React18的自动批处理 批处理原理 退出批处理 回首React过往的一些重大版本： React 16.0（2017年9月）：带来了全新的Fiber…","frontmatter":{"title":"谈一谈React18的批处理","description":"介绍React18的并发和批处理相关知识","cover":{"publicURL":"/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/react18-feature.jpg","childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAADAAL/2gAMAwEAAhADEAAAAeclkhySZv/EABkQAQACAwAAAAAAAAAAAAAAAAERMQACEv/aAAgBAQABBQKWBOm2trz/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAECEiUYH/2gAIAQEABj8CLYQuL//EABsQAAICAwEAAAAAAAAAAAAAAAABETEQIUFx/9oACAEBAAE/IWxdkFYRnwUFXjH/2gAMAwEAAgADAAAAEKP/AP/EABcRAQADAAAAAAAAAAAAAAAAAAEQESH/2gAIAQMBAT8QS8j/xAAWEQADAAAAAAAAAAAAAAAAAAABECH/2gAIAQIBAT8QMX//xAAcEAEAAwACAwAAAAAAAAAAAAABABEhMUFRYfD/2gAIAQEAAT8Q4Q5WAQPCaL9qy5y7yEGo6n2PEtn/2Q=="},"backgroundColor":"transparent","images":{"fallback":{"src":"/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/61244/react18-feature.jpg","srcSet":"/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/ff3f4/react18-feature.jpg 350w,\n/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/28eb3/react18-feature.jpg 700w,\n/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/61244/react18-feature.jpg 1400w","sizes":"(min-width: 1400px) 1400px, 100vw"},"sources":[{"srcSet":"/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/5e77f/react18-feature.avif 350w,\n/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/cfec4/react18-feature.avif 700w,\n/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/c2d43/react18-feature.avif 1400w","type":"image/avif","sizes":"(min-width: 1400px) 1400px, 100vw"},{"srcSet":"/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/81ac5/react18-feature.webp 350w,\n/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/c8680/react18-feature.webp 700w,\n/leon-blog/static/b1d2ff9419b4177e3d87c06130565a38/02cdb/react18-feature.webp 1400w","type":"image/webp","sizes":"(min-width: 1400px) 1400px, 100vw"}]},"width":1400,"height":702}}},"coverAlt":"封面","datePublished":"2024-06-24 19:28:20","dateModified":"2024-06-24 19:28:20","category":"经验总结","tags":["前端","React","架构","造轮子"]},"fields":{"slug":"/react-batch","route":"/react-batch","pathName":"/leon-blog/react-batch","url":"https://missmess.github.io/leon-blog/react-batch"},"internal":{"content":"---\ntitle: \"谈一谈React18的批处理\"\ncover: ../static/assets/react18-feature.jpg\ncoverAlt: \"封面\"\ndescription: \"介绍React18的并发和批处理相关知识\"\ndatePublished: \"2024-06-24 19:28:20\"\ndateModified: \"2024-06-24 19:28:20\"\nslug: \"react-batch\"\ncategory: \"经验总结\"\ntags:\n  - 前端\n  - React\n  - 架构\n  - 造轮子\n---\n\n最近笔者腾出了大把的时间，学习了一下React18。\n\n### 导航\n\n- [什么是批处理？](#什么是批处理？)\n- [React18之前的批处理](#react-18-之前的批处理)\n- [React18的自动批处理](#react-18-的自动批处理)\n- [批处理原理](#批处理原理)\n- [退出批处理](#退出批处理)\n\n回首React过往的一些重大版本：\n\n- React 16.0（2017年9月）：带来了全新的Fiber架构，引入了异步渲染提升性能，奠定了并发模式的基础。\n- React 16.8（2019年2月）：引入了`Hooks`，允许函数组件中管理状态和副作用。从此函数组件一发不可收拾。\n- React 17.0（2020年10月）：没有API更新，主要是为了未来平滑过渡18.0以及提升稳定性。\n- React 18.0（2022年3月）：React18带来了许多[新特性](https://github.com/facebook/react/blob/main/CHANGELOG.md#breaking-changes)，包括`Concurrent Mode`（并发模式）、`Automatic batching`（自动批处理）、新的SSR API、新的Suspense、`useTransition`等等...\n\n> 这些新特性是在React18正式发布的，但是看源码的话其实16.13的版本里就已经有了并发模式相关代码。只不过那个时候不稳定，处于开发状态。并且在17版本时，还提供了很多实验性的API。\n\n> 并发模式是一种底层设计，不单单指一个功能，而是一系列小特性的集合。并发模式的开启方式就是将`ReactDOM.render`改为`ReactDOM.createRoot`。\n\n18新特性很多，我们一个一个去讲。本次主要讲解其中的一个：**Automatic batching**，即自动批处理。官方解释说**自动批处理**是一次性能提升，更改了批量更新的方式以自动执行更多批处理。\n\n更多批处理？那在React18之前有批处理吗？现在又做了哪些改进？让我们娓娓道来：\n\n### 什么是批处理？\n\n批处理就是将一组状态更新合并，只触发一次渲染的性能优化手段。比如在一个点击事件里执行多条状态更新：\n\n```jsx\nfunction App() {\n  console.log('App rendered');\n  const [count, setCount] = useState(0);\n  const [flag, setFlag] = useState(false);\n\n  function handleClick() {\n    setCount(c => c + 1); // Does not re-render yet\n    setFlag(f => !f); // Does not re-render yet\n    // React will only re-render once at the end (that's batching!)\n  }\n\n  return (\n    <div>\n      <button onClick={handleClick}>Next</button>\n      <h1 style={{ color: flag ? \"blue\" : \"black\" }}>{count}</h1>\n    </div>\n  );\n}\n```\n\n示例中有两个状态更新在`handleClick`回调里同步执行，如果它们只触发一次渲染，即为批处理。（示例[CodeSandbox](https://codesandbox.io/p/sandbox/spring-water-929i6)）。\n\n> 包括下面的示例，参考的是[官方discussion](https://github.com/reactwg/react-18/discussions/21)。\n\n### React18之前的批处理\n\n上面的示例如果在React17上执行的话，是只触发一次渲染的。说明在17版本已经存在了批处理的能力。但是17版本只对事件处理器中的状态更新进行了批处理。而对于`setTimeout`、`Promise`、或者是原生dom事件里的状态更新则不会使用批处理。\n\n```javascript\nfunction handleClick() {\n  fetchSomething().then(() => {\n    // React 17 and earlier does NOT batch these because\n    // they run *after* the event in a callback, not *during* it\n    setCount(c => c + 1); // Causes a re-render\n    setFlag(f => !f); // Causes a re-render\n  });\n}\n```\n\n示例中，多加了一个fetch接口并在Promise处理后触发两个状态更新。在17版本上会发现，它触发了两次渲染。（示例[CodeSandbox](https://codesandbox.io/p/sandbox/trusting-khayyam-cn5ct)）。\n\n### React18的自动批处理\n\n上面示例中运行在React18的并发模式下。不管是未加fetch还是加了fetch的多次状态更新（示例[CodeSandbox](https://codesandbox.io/p/sandbox/morning-sun-lgz88)），运行后都只触发了一次渲染，所以它们的更新都进行了批处理。这就是18版本的自动批处理。\n\n但是要注意的是，如果18版本未开启并发模式。即仍然使用`ReactDOM.render`作为渲染入口，则使用的是`Legacy`模式。它的表现会和17版本的一致。（示例[CodeSandbox](https://codesandbox.io/p/sandbox/jolly-benz-hb1zx)）。\n\n### 批处理原理\n\n接下来我们直接查看React18源码，并将Legacy模式对应为React17的表现。分析下三个问题：\n\n1. 为什么Legacy模式下，事件处理器下的更新可以批处理。\n\n2. 为什么Legacy模式下，Promise或setTimeout或原生dom事件下的更新不可以批处理。\n\n3. 为什么并发模式下，事件处理器、Promise、setTimeout、原生dom事件下的更新都可以批处理。\n\n我们从触发更新的入口开始查看。如果是类组件的话，会调用`this.setState`；如果是函数组件，会调用`useState`返回的`dispatch`函数。这里看哪个都可以，除了第一步不一样，后续流程都一样。我们直接分析类组件的`this.setState`入口：\n\n1. `setState`方法会执行到`classComponentUpdater`的`enqueueSetState`方法。`enqueueSetState`方法会创建`Update`，请求lane，然后调用`scheduleUpdateOnFiber`准备调度更新。\n\n```javascript\n// 简化，去掉不重要的部分\nenqueueSetState: function(inst, payload, callback) {\n    // ...\n    var lane = requestUpdateLane();\n    var update = createUpdate(lane);\n    // ...\n    if (root !== null) {\n      scheduleUpdateOnFiber(root, fiber, lane);\n    }\n    // ...\n}\n```\n\n2. `requestUpdateLane`方法用于获取当前更新的lane。重点是Legacy模式下一定是`SyncLane`。并发模式下会读取提前预设的值或[根据window.event获取](https://github.com/facebook/react/blob/a15bbe14751287cb7ac124ff88f694d0883f3ac6/packages/react-dom-bindings/src/events/ReactDOMEventListener.js#L290)。\n\n```javascript\nfunction requestUpdateLane(fiber) {\n  // 非并发模式，一定是SyncLane\n  if ((mode & ConcurrentMode) === NoMode) {\n    return SyncLane;\n  }\n  // ...\n\n  // 先从预设的字段读取lane。由react在部分情况（比如click事件前）下提前设置\n  var updateLane = getCurrentUpdatePriority();\n  if (updateLane !== NoLane) {\n    return updateLane;\n  }\n  // 否则根据window.event判断当前lane\n  var eventLane = getCurrentEventPriority();\n  return eventLane;\n}\n```\n\n3. `scheduleUpdateOnFiber`方法会调用`ensureRootIsScheduled`方法发起调度更新，进到第4步。并在结束后，判断是否要刷新`Scheduler`的同步callback，进到第5步。\n\n```javascript\n// 简化，去掉不重要的部分\nfunction scheduleUpdateOnFiber(root, fiber, lane) {\n    // ...\n    ensureRootIsScheduled(root);\n    // 同步优先级 && 没有执行上下文 && 非并发模式\n    if (lane === SyncLane && executionContext === NoContext && (fiber.mode & ConcurrentMode) === NoMode) {\n      // Scheduler执行高优任务\n      flushSyncCallbacks();\n    }\n}\n```\n\n4. `ensureRootIsScheduled`方法根据lane判断是否：不需要发起一次新调度；需要取消已调度更新，并发起新调度；不需要取消已调度更新，并发起新调度；发起指定优先级的调度。调度成功后，发起一个微任务处理掉Scheduler高优任务。\n\n```javascript\nfunction ensureRootIsScheduled(root, currentTime) {\n  // ...\n  // 获取本次更新的lanes\n  var nextLanes = getNextLanes(root, workInProgressRootRenderLanes);\n  var newCallbackPriority = getHighestPriorityLane(nextLanes);\n  var existingCallbackPriority = root.callbackPriority;\n  // 已调度更新的优先级 === 本次更新优先级，不需要再发起一次调度\n  if (existingCallbackPriority === newCallbackPriority) {\n    return;\n  }\n  // 打断已调度更新\n  if (existingCallbackNode != null) {\n    cancelCallback$1(existingCallbackNode);\n  }\n  // 本次是同步优先级，则在Scheduler那里调度一次高优渲染任务。\n  if (newCallbackPriority === SyncLane) {\n    scheduleSyncCallback(performSyncWorkOnRoot.bind(null, root));\n  } else {\n    // lane转为Scheduler优先级\n    switch (lanesToEventPriority(nextLanes)) { /* ... */ }\n    // 在Scheduler那里调度一次指定优先级渲染任务\n    scheduleCallback$1(schedulerPriorityLevel, performConcurrentWorkOnRoot.bind(null, root));\n  }\n  // 作为微任务中，处理掉Scheduler中的高优任务\n  scheduleMicrotask(function () {\n    flushSyncCallbacks();\n  });\n}\n```\n\n5. 如果第3步中，**lane为同步优先级**且**没有执行上下文**且**非并发模式**，就会走到`flushSyncCallbacks`方法，该方法就是将Scheduler中高优任务执行掉。这个任务就包括我们可能在刚刚调度的渲染任务。\n\n源码看完了，我们接下来调试下代码，再结合代码，找一下3个问题的答案：\n\n- Legacy模式下，更新的lane值始终是`SyncLane`。并发模式下，根据更新类型获取lane。\n\n- `ensureRootIsScheduled`方法中，如果前面调度了一次更新，后面触发的更新优先级一样，那就直接return掉。\n\n- 如果更新没有被return掉的话，Legacy模式下，就会去Scheduler那里调度一次高优渲染任务。并发模式下，就会去调度一次指定优先级的渲染任务。\n\n- `scheduleUpdateOnFiber`方法里，如果当前没有**执行上下文**，则高优任务会立刻执行。如果有上下文，则高优任务会作为微任务在同步代码结束后异步执行。\n\n- 事件处理器里面触发的更新，在执行时是有**执行上下文**的。但是Promise里面触发的更新没有执行上下文。*（这是因为执行上下文是在事件处理器callback回调前设置，在结束后置空。所以异步的Promise里执行上下文就是空的）。*\n\n- 这就解释了问题1的表现，由于有上下文，并且都是同步优先级。所以后面的setState的更新被return掉了，渲染任务会在微任务里执行。实现了批处理。\n\n- 问题2，由于没有上下文，但是是同步优先级，所以调用一次`setState`，便立即完成一次渲染。再次调用`setState`时，又立即完成一次渲染。没有实现批处理。\n\n- 问题3，并发模式下不会立即执行渲染任务，最快也要等到微任务。所以不管在哪里的多次更新，因为有相同优先级，最后走到return。也就是自动批处理特性。\n\n到这里，我们就非常清楚的了解了批处理的实现原理，以及18版本前后的差异原因。\n\n再来一个复杂的例子，尝试分析下这个情况：\n\n```jsx\nfunction App() {\n  const [count, setCount] = useState(0);\n  console.log(\"App render\");\n\n  function plus() {\n    setCount(count + 1);\n    Promise.resolve().then(() => {\n      setCount(count + 2);\n    });\n  }\n\n  return (\n    <div>\n    <p>{count}</p>\n    {/* 点击会render两次，滑入却只render一次 */}\n    <span onClick={plus} onMouseEnter={plus}>\n      滑入或点击\n    </span>\n    </div>\n  );\n}\n```\n\n示例中，在`onClick`和`onMouseEnter`回调中都执行了`plus()`方法，但是结果却完全不一样。有童鞋知道是为什么吗？\n\n直接公布答案：\n\n`onMouseEnter`回调中触发的更新为`InputContinuousLane`，而`onClick`回调中触发的更新为`SyncLane`。第一次setCount和第二次setCount的lane相同（只是一个是从预设值获取，一个是通过window.event获取）。\n\n由于mouseEnter事件是普通优先级，所以调用第一次setCount后，会调度一次渲染任务，后续宏任务中执行。微任务中的第二次setCount，优先级相同，所以return掉了。最终仅渲染一次。\n\n由于click事件是同步优先级，所以第一次setCount后会在微任务完成一次渲染任务。第二次setCount也是在微任务中，它排在渲染任务后面。所以会先完成渲染，再执行第二次setCount，并再次完成一次渲染。最终渲染两次。\n\n> 思考题：如果将`plus()`中的Promise换成setTimeout。两个事件分别会渲染几次？（都渲染两次）。\n\n### 退出批处理\n\n我们上面分析到问题2的情况，会在调用`setState`后立即完成一次渲染。是不是说明在`setState`后获取`this.state`能取到最新的状态呢？\n\n```javascript\n// React17\nhandleClick = () => {\n  setTimeout(() => {\n    this.setState(({ count }) => ({ count: count + 1 }));\n\n    console.log(this.state); // { count: 1, flag: false }\n\n    this.setState(({ flag }) => ({ flag: !flag }));\n  });\n};\n```\n\n答案是肯定的，由于是同步执行的渲染，所以this.state也在更新完成后变更了。所以取到的就是最新的state。这是类组件的表现，那函数组件下取到的state会是最新的吗？*（当然不可能啊！因为函数组件中的变量是快照啊，也即临时变量，可不管你渲染完成了还是没完成）。*\n\nReact18并发模式下由于都是批处理，所以同样的代码，在这里的console，就会打印出不一样的结果。即还是原来的state（`{ count: 0, flag: false }`）。这也是个问题哈，如果我从React17升级到React18，这里就出现了表现不一致了。\n\n所以React提供了一个新的api：`ReactDOM.flushSync`，这个方法可以让某个状态更新立即完成渲染。所以代码变为：\n\n```javascript\n// React18\nhandleClick = () => {\n  setTimeout(() => {\n    ReactDOM.flushSync(() => {\n      this.setState(({ count }) => ({ count: count + 1 }));\n    });\n\n    console.log(this.state); // { count: 1, flag: false }\n\n    this.setState(({ flag }) => ({ flag: !flag }));\n  });\n};\n```"}}},"pageContext":{"slug":"/react-batch","nexttitle":"【uniapp】与原生通信的几种方式","nextslug":"/【uniapp】与原生通信的几种方式","prevtitle":"npm-lib-starter","prevslug":"/npm-lib-starter","relatedPosts":[{"title":"谈一谈React18的RSC","description":"介绍React18的RSC相关知识，参考：https://article.juejin.cn/post/7220061751399170103#heading-13和https://dev.to/jankoritak/server-components-vs-ssr-1g8c","coverImg":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB59M1QD//xAAYEAADAQEAAAAAAAAAAAAAAAABAgMQEf/aAAgBAQABBQJZlohd6c//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAADAAMAAAAAAAAAAAAAAAACEBEAITH/2gAIAQEABj8CI9Qcr6v/xAAcEAACAgIDAAAAAAAAAAAAAAABEQAxECFBYZH/2gAIAQEAAT8hGHcRbc1cg1RhuMqzOx7j/9oADAMBAAIAAwAAABDTD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAwADAAAAAAAAAAAAAAERIQAxQRBRcf/aAAgBAQABPxABABrExqK7gpaQYrcWa+ZsgC9GAIAPQ5o4slvH/9k="},"backgroundColor":"transparent","images":{"fallback":{"src":"/leon-blog/static/6890535e3478882b78f0403eb486168d/4710f/react-rsc-cover.jpg","srcSet":"/leon-blog/static/6890535e3478882b78f0403eb486168d/002be/react-rsc-cover.jpg 165w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/b4f54/react-rsc-cover.jpg 330w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/4710f/react-rsc-cover.jpg 659w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/eeb57/react-rsc-cover.jpg 1318w","sizes":"(min-width: 659px) 659px, 100vw"},"sources":[{"srcSet":"/leon-blog/static/6890535e3478882b78f0403eb486168d/79731/react-rsc-cover.avif 165w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/6ae0f/react-rsc-cover.avif 330w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/b9b98/react-rsc-cover.avif 659w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/4ddb9/react-rsc-cover.avif 1318w","type":"image/avif","sizes":"(min-width: 659px) 659px, 100vw"},{"srcSet":"/leon-blog/static/6890535e3478882b78f0403eb486168d/55a9a/react-rsc-cover.webp 165w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/39687/react-rsc-cover.webp 330w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/62d22/react-rsc-cover.webp 659w,\n/leon-blog/static/6890535e3478882b78f0403eb486168d/6c1b1/react-rsc-cover.webp 1318w","type":"image/webp","sizes":"(min-width: 659px) 659px, 100vw"}]},"width":659,"height":368},"coverImageAlt":"封面","datePublished":"2024-10-15T19:32:24.000Z","dateModified":"2024-10-15T19:32:24.000Z","category":"经验总结","tags":["前端","React","架构","造轮子","Next"],"excerpt":"最近笔者腾出了大把的时间，学习了一下React18。 导航 什么是RSC 客户端组件的缺点 服务器组件如何解决问题 使用RSC RSC的缺点 总结一：RSC和RCC RSC对比SSR Next.js下RSC的工作流程 总结二：RSC和SSR 其它 什么是RSC React1…","timeToRead":2,"slug":"/react-rsc","route":"/react-rsc","pathName":"/leon-blog/react-rsc","url":"https://missmess.github.io/leon-blog/react-rsc"},{"title":"谈一谈React18的SSR","description":"介绍React18的SSR相关知识","coverImg":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAADBP/aAAwDAQACEAMQAAABboazHjQIBr//xAAbEAACAQUAAAAAAAAAAAAAAAAAAQIDBBAjMf/aAAgBAQABBQJsrS14u+n/xAAXEQADAQAAAAAAAAAAAAAAAAABAhAh/9oACAEDAQE/AU0z/8QAFhEAAwAAAAAAAAAAAAAAAAAAAhAx/9oACAECAQE/ASi//8QAGhAAAQUBAAAAAAAAAAAAAAAAEAABAhEhUf/aAAgBAQAGPwJV3DFh/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARECFRkf/aAAgBAQABPyFB0nkouaXDpcN5KXH/2gAMAwEAAgADAAAAELQP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EDiT/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/ECif/8QAHhABAQABAwUAAAAAAAAAAAAAAREhABAxQWFxgcH/2gAIAQEAAT8QlQHdP3VmI6Dpy48GiCGgwdsrYexZt//Z"},"backgroundColor":"transparent","images":{"fallback":{"src":"/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/70a21/react-ssr-cover.jpg","srcSet":"/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/2a6d8/react-ssr-cover.jpg 147w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/f5d63/react-ssr-cover.jpg 295w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/70a21/react-ssr-cover.jpg 589w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/a19e9/react-ssr-cover.jpg 1178w","sizes":"(min-width: 589px) 589px, 100vw"},"sources":[{"srcSet":"/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/34bea/react-ssr-cover.avif 147w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/24e48/react-ssr-cover.avif 295w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/b6890/react-ssr-cover.avif 589w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/319a1/react-ssr-cover.avif 1178w","type":"image/avif","sizes":"(min-width: 589px) 589px, 100vw"},{"srcSet":"/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/9862c/react-ssr-cover.webp 147w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/6e9d7/react-ssr-cover.webp 295w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/4b50c/react-ssr-cover.webp 589w,\n/leon-blog/static/4e049eb08e0645207ac2ff6babe990e0/bcd24/react-ssr-cover.webp 1178w","type":"image/webp","sizes":"(min-width: 589px) 589px, 100vw"}]},"width":589,"height":368},"coverImageAlt":"封面","datePublished":"2024-07-20T12:04:20.000Z","dateModified":"2024-07-20T12:04:20.000Z","category":"经验总结","tags":["前端","React","架构","造轮子","Next"],"excerpt":"最近笔者腾出了大把的时间，学习了一下React18。 导航 什么是SSR React18之前的旧SSR 手动实现旧SSR 为什么用Next.js React18的新SSR Suspense组件 流式传输Html 流式HTML + Suspense 选择性水合 + Suspense…","timeToRead":3,"slug":"/react-ssr","route":"/react-ssr","pathName":"/leon-blog/react-ssr","url":"https://missmess.github.io/leon-blog/react-ssr"}]}},"staticQueryHashes":["2792541146","2845918323"]}